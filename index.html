<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ParkTap ‚Äî Find Parking Near You</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Syne:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0c0f; --surface: #111418; --card: #161b22; --border: #21272f;
    --green: #00e87a; --green-dim: #00e87a22; --yellow: #f5c518; --yellow-dim: #f5c51822;
    --blue: #3d9eff; --blue-dim: #3d9eff22; --red: #ff4757; --text: #e8edf3; --muted: #6b7280;
  }
  * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
  body { background:var(--bg); color:var(--text); font-family:'Syne',sans-serif; min-height:100vh; overflow-x:hidden; }

  .header { padding:20px 20px 0; display:flex; justify-content:space-between; align-items:center; }
  .logo { font-size:22px; font-weight:800; letter-spacing:-1px; }
  .logo span { color:var(--green); }
  .time { font-family:'Space Mono',monospace; font-size:12px; color:var(--muted); }

  .hero { padding:36px 20px 20px; display:flex; flex-direction:column; align-items:center; gap:14px; }
  .find-btn {
    width:190px; height:190px; border-radius:50%; border:none;
    background:conic-gradient(from 180deg, #00e87a, #00c4ff, #00e87a);
    cursor:pointer; position:relative; display:flex; align-items:center; justify-content:center;
    transition:transform 0.15s, box-shadow 0.15s;
    box-shadow:0 0 60px #00e87a44, 0 0 120px #00e87a22;
  }
  .find-btn::before { content:''; position:absolute; inset:3px; border-radius:50%; background:var(--bg); }
  .find-btn:active { transform:scale(0.94); }
  .find-btn.loading { animation:spin-glow 1s linear infinite; }
  @keyframes spin-glow { 0%{filter:hue-rotate(0deg)} 100%{filter:hue-rotate(360deg)} }
  .find-btn-inner { position:relative; z-index:1; display:flex; flex-direction:column; align-items:center; gap:6px; }
  .find-icon { font-size:42px; line-height:1; }
  .find-label { font-size:12px; font-weight:700; letter-spacing:1px; text-transform:uppercase; }
  .tagline { font-size:13px; color:var(--muted); }

  .filters { display:flex; gap:8px; padding:0 20px; overflow-x:auto; scrollbar-width:none; }
  .filters::-webkit-scrollbar { display:none; }
  .pill { flex-shrink:0; padding:7px 16px; border-radius:100px; border:1px solid var(--border); background:var(--card); font-size:13px; font-weight:600; color:var(--muted); cursor:pointer; transition:all 0.15s; }
  .pill.active { background:var(--green-dim); border-color:var(--green); color:var(--green); }

  .status-bar { margin:16px 20px 10px; padding:12px 16px; background:var(--card); border-radius:12px; border:1px solid var(--border); display:flex; align-items:center; gap:10px; font-size:13px; color:var(--muted); min-height:46px; }
  .status-dot { width:8px; height:8px; border-radius:50%; background:var(--muted); flex-shrink:0; }
  .status-dot.green { background:var(--green); box-shadow:0 0 8px var(--green); animation:pulse 2s ease-in-out infinite; }
  .status-dot.red { background:var(--red); }
  @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.4} }

  .results { padding:0 20px 120px; display:flex; flex-direction:column; gap:10px; }
  .section-label { font-size:11px; font-weight:700; letter-spacing:2px; text-transform:uppercase; color:var(--muted); margin:10px 0 4px; }

  .spot-card { background:var(--card); border:1px solid var(--border); border-radius:16px; padding:14px; display:flex; align-items:center; gap:12px; cursor:pointer; transition:transform 0.12s; animation:slideUp 0.35s ease both; }
  .spot-card:active { transform:scale(0.98); }
  @keyframes slideUp { from{opacity:0;transform:translateY(16px)} to{opacity:1;transform:translateY(0)} }

  .spot-icon-wrap { width:48px; height:48px; border-radius:13px; display:flex; align-items:center; justify-content:center; font-size:22px; flex-shrink:0; }
  .spot-icon-wrap.garage { background:var(--green-dim); }
  .spot-icon-wrap.lot { background:var(--blue-dim); }
  .spot-icon-wrap.street { background:var(--yellow-dim); }

  .spot-info { flex:1; min-width:0; }
  .spot-name { font-size:14px; font-weight:700; margin-bottom:3px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
  .spot-meta { display:flex; align-items:center; gap:6px; font-family:'Space Mono',monospace; font-size:11px; color:var(--muted); flex-wrap:wrap; }
  .spot-meta .dist { color:var(--blue); }

  .spot-right { text-align:right; flex-shrink:0; }
  .avail-badge { display:inline-flex; align-items:center; gap:4px; padding:4px 9px; border-radius:100px; font-size:11px; font-weight:700; }
  .avail-badge.open { background:var(--green-dim); color:var(--green); }
  .avail-badge.closed { background:rgba(255,71,87,0.15); color:var(--red); }
  .avail-badge.unknown { background:#ffffff11; color:var(--muted); }
  .avail-badge::before { content:''; width:5px; height:5px; border-radius:50%; background:currentColor; }
  .walk-time { font-family:'Space Mono',monospace; font-size:11px; color:var(--muted); margin-top:3px; }

  .sheet-overlay { position:fixed; inset:0; background:rgba(0,0,0,0.75); z-index:100; opacity:0; pointer-events:none; transition:opacity 0.3s; backdrop-filter:blur(4px); }
  .sheet-overlay.open { opacity:1; pointer-events:all; }
  .sheet { position:fixed; bottom:0; left:0; right:0; background:var(--surface); border-radius:24px 24px 0 0; border-top:1px solid var(--border); padding:12px 24px 44px; z-index:101; transform:translateY(100%); transition:transform 0.35s cubic-bezier(0.32,0.72,0,1); max-height:85vh; overflow-y:auto; }
  .sheet.open { transform:translateY(0); }
  .sheet-handle { width:40px; height:4px; background:var(--border); border-radius:2px; margin:0 auto 20px; }
  .sheet-icon-big { font-size:44px; margin-bottom:10px; }
  .sheet-name { font-size:22px; font-weight:800; margin-bottom:5px; line-height:1.2; }
  .sheet-addr { font-size:13px; color:var(--muted); margin-bottom:18px; }
  .sheet-stats { display:grid; grid-template-columns:repeat(2,1fr); gap:10px; margin-bottom:18px; }
  .sheet-stat { background:var(--card); border-radius:12px; border:1px solid var(--border); padding:14px 10px; text-align:center; }
  .sheet-stat-val { font-size:18px; font-weight:800; margin-bottom:2px; }
  .sheet-stat-lbl { font-size:10px; color:var(--muted); text-transform:uppercase; letter-spacing:1px; }
  .sheet-features { display:flex; flex-wrap:wrap; gap:7px; margin-bottom:22px; }
  .feature-tag { padding:5px 12px; background:var(--card); border:1px solid var(--border); border-radius:100px; font-size:12px; color:var(--muted); }
  .sheet-actions { display:flex; gap:10px; }
  .btn-primary { flex:1; padding:16px; background:var(--green); color:#000; border:none; border-radius:14px; font-family:'Syne',sans-serif; font-size:15px; font-weight:800; cursor:pointer; transition:opacity 0.15s, transform 0.15s; }
  .btn-primary:active { opacity:0.85; transform:scale(0.98); }
  .btn-secondary { padding:16px 18px; background:var(--card); color:var(--text); border:1px solid var(--border); border-radius:14px; font-size:20px; cursor:pointer; }

  .empty { text-align:center; padding:50px 20px; color:var(--muted); display:none; }
  .empty.show { display:block; }
  .empty-icon { font-size:44px; margin-bottom:10px; }
  .empty h3 { font-size:17px; margin-bottom:6px; color:var(--text); }
</style>
</head>
<body>

<div class="header">
  <div class="logo">Park<span>Tap</span></div>
  <div class="time" id="timeDisplay">--:--</div>
</div>

<div class="hero">
  <button class="find-btn" id="findBtn" onclick="findParking()">
    <div class="find-btn-inner">
      <div class="find-icon">üÖøÔ∏è</div>
      <div class="find-label" id="btnLabel">Tap to Find</div>
    </div>
  </button>
  <div class="tagline">Real parking spots ‚Üí Google Maps navigation</div>
</div>

<div class="filters">
  <div class="pill active" onclick="toggleFilter(this,'all')">All</div>
  <div class="pill" onclick="toggleFilter(this,'garage')">üè¢ Garages</div>
  <div class="pill" onclick="toggleFilter(this,'lot')">üÖøÔ∏è Lots</div>
</div>

<div class="status-bar">
  <div class="status-dot" id="statusDot"></div>
  <span id="statusText">Tap the button to find parking near you</span>
</div>

<div class="results" id="results"></div>
<div class="empty" id="emptyState">
  <div class="empty-icon">üîç</div>
  <h3>No spots found nearby</h3>
  <p>Try moving to a more urban area or check your location permissions</p>
</div>

<div class="sheet-overlay" id="overlay" onclick="closeSheet()"></div>
<div class="sheet" id="sheet">
  <div class="sheet-handle"></div>
  <div id="sheetContent"></div>
</div>

<script>
  // !! IMPORTANT: After deploying to Vercel, replace this URL with your actual Vercel URL
  // It will look like: https://parktap-abc123.vercel.app
  const BACKEND_URL = 'https://one-touch-parking-finder-backend.vercel.app';

  let activeFilter = 'all';
  let allSpots = [];

  function updateTime() {
    const now = new Date();
    document.getElementById('timeDisplay').textContent =
      now.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
  }
  updateTime();
  setInterval(updateTime, 1000);

  function toggleFilter(el, type) {
    document.querySelectorAll('.pill').forEach(p => p.classList.remove('active'));
    el.classList.add('active');
    activeFilter = type;
    renderSpots();
  }

  function setStatus(msg, type) {
    document.getElementById('statusText').textContent = msg;
    const dot = document.getElementById('statusDot');
    dot.className = 'status-dot' + (type ? ' ' + type : '');
  }

  function findParking() {
    const btn = document.getElementById('findBtn');
    document.getElementById('btnLabel').textContent = 'Locating‚Ä¶';
    btn.classList.add('loading');
    setStatus('Getting your location‚Ä¶');

    if (!navigator.geolocation) {
      setStatus('Geolocation not supported on this device', 'red');
      btn.classList.remove('loading');
      document.getElementById('btnLabel').textContent = 'Tap to Find';
      return;
    }

    navigator.geolocation.getCurrentPosition(
      pos => {
        const lat = pos.coords.latitude;
        const lon = pos.coords.longitude;
        setStatus('Found you! Searching for parking‚Ä¶', 'green');
        fetchParkingFromBackend(lat, lon);
      },
      err => {
        const btn = document.getElementById('findBtn');
        btn.classList.remove('loading');
        document.getElementById('btnLabel').textContent = 'Tap to Find';
        if (err.code === 1) {
          setStatus('Location blocked ‚Äî tap here to allow location in browser settings', 'red');
        } else {
          setStatus('Could not get location. Check connection and try again.', 'red');
        }
      },
      { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
    );
  }

  async function fetchParkingFromBackend(lat, lon) {
    try {
      const res = await fetch(`${BACKEND_URL}/api/parking?lat=${lat}&lon=${lon}`);
      const data = await res.json();

      const btn = document.getElementById('findBtn');
      btn.classList.remove('loading');
      document.getElementById('btnLabel').textContent = 'Tap to Refresh';

      if (data.results && data.results.length > 0) {
        allSpots = data.results.map(place => {
          const pLat = place.geometry.location.lat;
          const pLon = place.geometry.location.lng;
          const dist = getDistanceMiles(lat, lon, pLat, pLon);
          return {
            id: place.place_id,
            name: place.name,
            address: place.vicinity || '',
            lat: pLat,
            lon: pLon,
            dist: dist.toFixed(2),
            walk: Math.round(dist * 1609 / 80),
            type: inferType(place.name),
            open: place.opening_hours ? place.opening_hours.open_now : null,
            rating: place.rating || null,
          };
        }).sort((a, b) => parseFloat(a.dist) - parseFloat(b.dist));

        setStatus(`Found ${allSpots.length} real parking spots near you`, 'green');
        renderSpots();
      } else {
        setStatus('No parking found nearby ‚Äî try a busier area', 'red');
        document.getElementById('emptyState').classList.add('show');
      }
    } catch (err) {
      const btn = document.getElementById('findBtn');
      btn.classList.remove('loading');
      document.getElementById('btnLabel').textContent = 'Tap to Find';
      setStatus('Could not reach server. Check your connection.', 'red');
    }
  }

  function inferType(name) {
    const n = (name || '').toLowerCase();
    if (n.includes('garage') || n.includes('parkade') || n.includes('deck')) return 'garage';
    return 'lot';
  }

  function getDistanceMiles(lat1, lon1, lat2, lon2) {
    const R = 3958.8;
    const dLat = (lat2 - lat1) * Math.PI / 180;
    const dLon = (lon2 - lon1) * Math.PI / 180;
    const a = Math.sin(dLat/2)**2 + Math.cos(lat1*Math.PI/180) * Math.cos(lat2*Math.PI/180) * Math.sin(dLon/2)**2;
    return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
  }

  function typeIcon(type) {
    return { garage:'üè¢', lot:'üÖøÔ∏è', street:'üõ£Ô∏è' }[type] || 'üÖøÔ∏è';
  }
  function typeName(type) {
    return { garage:'Parking Garage', lot:'Parking Lot', street:'Street Parking' }[type] || 'Parking';
  }

  function renderSpots() {
    const container = document.getElementById('results');
    container.innerHTML = '';
    const empty = document.getElementById('emptyState');

    let filtered = allSpots;
    if (activeFilter !== 'all') filtered = allSpots.filter(s => s.type === activeFilter);
    if (filtered.length === 0) { empty.classList.add('show'); return; }
    empty.classList.remove('show');

    filtered.forEach((spot, i) => {
      const card = document.createElement('div');
      card.className = 'spot-card';
      card.style.animationDelay = i * 55 + 'ms';

      const badge = spot.open === true
        ? `<div class="avail-badge open">Open Now</div>`
        : spot.open === false
          ? `<div class="avail-badge closed">Closed</div>`
          : `<div class="avail-badge unknown">Check Hours</div>`;

      card.innerHTML = `
        <div class="spot-icon-wrap ${spot.type}">${typeIcon(spot.type)}</div>
        <div class="spot-info">
          <div class="spot-name">${spot.name}</div>
          <div class="spot-meta">
            <span class="dist">${spot.dist} mi</span>
            <span>¬∑</span>
            <span>${typeName(spot.type)}</span>
            ${spot.rating ? `<span>¬∑</span><span>‚≠ê ${spot.rating}</span>` : ''}
          </div>
        </div>
        <div class="spot-right">
          ${badge}
          <div class="walk-time">~${spot.walk} min walk</div>
        </div>
      `;
      card.onclick = () => openSheet(spot);
      container.appendChild(card);
    });
  }

  function openSheet(spot) {
    const c = document.getElementById('sheetContent');
    const badge = spot.open === true
      ? `<div class="feature-tag" style="color:var(--green)">‚úÖ Open Now</div>`
      : spot.open === false
        ? `<div class="feature-tag" style="color:var(--red)">‚ùå Currently Closed</div>`
        : `<div class="feature-tag">üïê Hours Unknown</div>`;

    c.innerHTML = `
      <div class="sheet-icon-big">${typeIcon(spot.type)}</div>
      <div class="sheet-name">${spot.name}</div>
      <div class="sheet-addr">üìç ${spot.address}</div>
      <div class="sheet-stats">
        <div class="sheet-stat">
          <div class="sheet-stat-val" style="color:var(--blue)">${spot.dist} mi</div>
          <div class="sheet-stat-lbl">Distance</div>
        </div>
        <div class="sheet-stat">
          <div class="sheet-stat-val" style="color:var(--green)">${spot.walk} min</div>
          <div class="sheet-stat-lbl">Walk Time</div>
        </div>
      </div>
      <div class="sheet-features">
        <div class="feature-tag">${typeName(spot.type)}</div>
        ${spot.rating ? `<div class="feature-tag">‚≠ê ${spot.rating} rating</div>` : ''}
        ${badge}
      </div>
      <div class="sheet-actions">
        <button class="btn-primary" onclick="navigateToSpot(${spot.lat}, ${spot.lon})">
          üß≠ Open in Google Maps
        </button>
        <button class="btn-secondary" onclick="closeSheet()">‚úï</button>
      </div>
    `;
    document.getElementById('overlay').classList.add('open');
    document.getElementById('sheet').classList.add('open');
  }

  function closeSheet() {
    document.getElementById('overlay').classList.remove('open');
    document.getElementById('sheet').classList.remove('open');
  }

  function navigateToSpot(lat, lon) {
    closeSheet();
    window.open(`https://www.google.com/maps/dir/?api=1&destination=${lat},${lon}&travelmode=driving`, '_blank');
  }
</script>
</body>
</html>
