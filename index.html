<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>ParkTap ‚Äî Find Parking Near You</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Syne:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0c0f;
    --surface: #111418;
    --card: #161b22;
    --border: #21272f;
    --green: #00e87a;
    --green-dim: #00e87a22;
    --yellow: #f5c518;
    --yellow-dim: #f5c51822;
    --blue: #3d9eff;
    --blue-dim: #3d9eff22;
    --red: #ff4757;
    --text: #e8edf3;
    --muted: #6b7280;
    --accent: #00e87a;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Syne', sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* HEADER */
  .header {
    padding: 20px 20px 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .logo {
    font-size: 22px;
    font-weight: 800;
    letter-spacing: -1px;
  }
  .logo span { color: var(--green); }
  .time {
    font-family: 'Space Mono', monospace;
    font-size: 12px;
    color: var(--muted);
  }

  /* HERO BUTTON */
  .hero {
    padding: 40px 20px 24px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 14px;
  }
  .find-btn {
    width: 200px;
    height: 200px;
    border-radius: 50%;
    border: none;
    background: conic-gradient(from 180deg, #00e87a, #00c4ff, #00e87a);
    cursor: pointer;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform 0.15s, box-shadow 0.15s;
    box-shadow: 0 0 60px #00e87a44, 0 0 120px #00e87a22;
  }
  .find-btn::before {
    content: '';
    position: absolute;
    inset: 3px;
    border-radius: 50%;
    background: var(--bg);
  }
  .find-btn:active { transform: scale(0.94); box-shadow: 0 0 30px #00e87a44; }
  .find-btn.loading {
    animation: spin-glow 1s linear infinite;
  }
  @keyframes spin-glow {
    0% { filter: hue-rotate(0deg); }
    100% { filter: hue-rotate(360deg); }
  }
  .find-btn-inner {
    position: relative;
    z-index: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
  }
  .find-icon { font-size: 44px; line-height: 1; }
  .find-label {
    font-size: 13px;
    font-weight: 700;
    letter-spacing: 1px;
    text-transform: uppercase;
  }

  .tagline {
    font-size: 14px;
    color: var(--muted);
    text-align: center;
  }

  /* FILTER PILLS */
  .filters {
    display: flex;
    gap: 8px;
    padding: 0 20px;
    overflow-x: auto;
    scrollbar-width: none;
  }
  .filters::-webkit-scrollbar { display: none; }
  .pill {
    flex-shrink: 0;
    padding: 7px 16px;
    border-radius: 100px;
    border: 1px solid var(--border);
    background: var(--card);
    font-size: 13px;
    font-weight: 600;
    color: var(--muted);
    cursor: pointer;
    transition: all 0.15s;
  }
  .pill.active { background: var(--green-dim); border-color: var(--green); color: var(--green); }

  /* STATUS BAR */
  .status-bar {
    margin: 20px 20px 12px;
    padding: 12px 16px;
    background: var(--card);
    border-radius: 12px;
    border: 1px solid var(--border);
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 13px;
    color: var(--muted);
    min-height: 48px;
  }
  .status-dot {
    width: 8px; height: 8px;
    border-radius: 50%;
    background: var(--muted);
    flex-shrink: 0;
  }
  .status-dot.green { background: var(--green); box-shadow: 0 0 8px var(--green); animation: pulse 2s ease-in-out infinite; }
  @keyframes pulse { 0%,100% { opacity: 1; } 50% { opacity: 0.4; } }

  /* RESULTS */
  .results {
    padding: 0 20px 100px;
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .section-label {
    font-size: 11px;
    font-weight: 700;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--muted);
    margin: 8px 0 4px;
  }

  .spot-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 16px;
    display: flex;
    align-items: center;
    gap: 14px;
    cursor: pointer;
    transition: transform 0.12s, border-color 0.12s, background 0.12s;
    animation: slideUp 0.4s ease both;
  }
  .spot-card:active { transform: scale(0.98); }
  .spot-card:hover { border-color: #2d3748; background: #1a2030; }
  @keyframes slideUp {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .spot-icon-wrap {
    width: 52px; height: 52px;
    border-radius: 14px;
    display: flex; align-items: center; justify-content: center;
    font-size: 24px;
    flex-shrink: 0;
  }
  .spot-icon-wrap.street { background: var(--blue-dim); }
  .spot-icon-wrap.lot    { background: var(--green-dim); }
  .spot-icon-wrap.private { background: var(--yellow-dim); }

  .spot-info { flex: 1; min-width: 0; }
  .spot-name {
    font-size: 15px;
    font-weight: 700;
    margin-bottom: 3px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .spot-meta {
    display: flex; align-items: center; gap: 8px;
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    color: var(--muted);
    flex-wrap: wrap;
  }
  .spot-meta .dist { color: var(--blue); }
  .spot-meta .price { color: var(--yellow); }

  .spot-right { text-align: right; flex-shrink: 0; }
  .avail-badge {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    padding: 4px 10px;
    border-radius: 100px;
    font-size: 11px;
    font-weight: 700;
  }
  .avail-badge.high { background: var(--green-dim); color: var(--green); }
  .avail-badge.med  { background: var(--yellow-dim); color: var(--yellow); }
  .avail-badge.low  { background: rgba(255,71,87,0.15); color: var(--red); }
  .avail-badge::before {
    content: '';
    width: 5px; height: 5px;
    border-radius: 50%;
    background: currentColor;
  }

  .walk-time {
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    color: var(--muted);
    margin-top: 4px;
  }

  /* DETAIL SHEET */
  .sheet-overlay {
    position: fixed; inset: 0;
    background: rgba(0,0,0,0.7);
    z-index: 100;
    opacity: 0; pointer-events: none;
    transition: opacity 0.3s;
    backdrop-filter: blur(4px);
  }
  .sheet-overlay.open { opacity: 1; pointer-events: all; }

  .sheet {
    position: fixed; bottom: 0; left: 0; right: 0;
    background: var(--surface);
    border-radius: 24px 24px 0 0;
    border-top: 1px solid var(--border);
    padding: 12px 24px 40px;
    z-index: 101;
    transform: translateY(100%);
    transition: transform 0.35s cubic-bezier(0.32,0.72,0,1);
    max-height: 80vh;
    overflow-y: auto;
  }
  .sheet.open { transform: translateY(0); }
  .sheet-handle {
    width: 40px; height: 4px;
    background: var(--border);
    border-radius: 2px;
    margin: 0 auto 20px;
  }

  .sheet-icon-big {
    font-size: 48px;
    margin-bottom: 12px;
  }
  .sheet-name {
    font-size: 24px;
    font-weight: 800;
    margin-bottom: 6px;
  }
  .sheet-addr {
    font-size: 13px;
    color: var(--muted);
    margin-bottom: 20px;
  }

  .sheet-stats {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
    margin-bottom: 20px;
  }
  .sheet-stat {
    background: var(--card);
    border-radius: 12px;
    border: 1px solid var(--border);
    padding: 14px 10px;
    text-align: center;
  }
  .sheet-stat-val {
    font-size: 20px;
    font-weight: 800;
    margin-bottom: 2px;
  }
  .sheet-stat-lbl {
    font-size: 10px;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  .sheet-features {
    display: flex; flex-wrap: wrap; gap: 8px;
    margin-bottom: 24px;
  }
  .feature-tag {
    padding: 5px 12px;
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 100px;
    font-size: 12px;
    color: var(--muted);
  }

  .sheet-actions { display: flex; gap: 10px; }
  .btn-primary {
    flex: 1;
    padding: 16px;
    background: var(--green);
    color: #000;
    border: none;
    border-radius: 14px;
    font-family: 'Syne', sans-serif;
    font-size: 15px;
    font-weight: 800;
    cursor: pointer;
    transition: opacity 0.15s, transform 0.15s;
  }
  .btn-primary:active { opacity: 0.85; transform: scale(0.98); }
  .btn-secondary {
    padding: 16px 20px;
    background: var(--card);
    color: var(--text);
    border: 1px solid var(--border);
    border-radius: 14px;
    font-family: 'Syne', sans-serif;
    font-size: 20px;
    cursor: pointer;
    transition: background 0.15s;
  }
  .btn-secondary:active { background: var(--border); }

  /* EMPTY / LOADING */
  .empty {
    text-align: center;
    padding: 60px 20px;
    color: var(--muted);
    display: none;
  }
  .empty.show { display: block; }
  .empty-icon { font-size: 48px; margin-bottom: 12px; }
  .empty h3 { font-size: 18px; margin-bottom: 6px; color: var(--text); }

  /* MAP MINI */
  .mini-map {
    margin: 0 20px 20px;
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 16px;
    height: 140px;
    overflow: hidden;
    position: relative;
    display: none;
  }
  .mini-map.show { display: block; }
  .mini-map canvas { width: 100%; height: 100%; }
  .map-overlay {
    position: absolute; inset: 0;
    display: flex; align-items: center; justify-content: center;
  }
  .my-loc {
    width: 16px; height: 16px;
    background: var(--blue);
    border-radius: 50%;
    border: 3px solid white;
    box-shadow: 0 0 0 6px rgba(61,158,255,0.25);
    animation: pulse 2s ease-in-out infinite;
  }

  /* MAP DOTS */
  .map-dot {
    position: absolute;
    width: 10px; height: 10px;
    border-radius: 50%;
    transform: translate(-50%, -50%);
  }
  .map-dot.street { background: var(--blue); }
  .map-dot.lot { background: var(--green); }
  .map-dot.private { background: var(--yellow); }

  .legend {
    position: absolute;
    bottom: 10px; right: 10px;
    display: flex; flex-direction: column; gap: 4px;
  }
  .legend-item {
    display: flex; align-items: center; gap: 5px;
    font-size: 10px;
    color: var(--text);
    background: rgba(0,0,0,0.7);
    padding: 2px 7px 2px 5px;
    border-radius: 100px;
  }
  .legend-dot {
    width: 7px; height: 7px;
    border-radius: 50%;
  }
</style>
</head>
<body>

<div class="header">
  <div class="logo">Park<span>Tap</span></div>
  <div class="time" id="timeDisplay">--:--</div>
</div>

<div class="hero">
  <button class="find-btn" id="findBtn" onclick="findParking()">
    <div class="find-btn-inner">
      <div class="find-icon">üÖøÔ∏è</div>
      <div class="find-label" id="btnLabel">Tap to Find</div>
    </div>
  </button>
  <div class="tagline">One tap ‚Äî real spots near you</div>
</div>

<div class="filters">
  <div class="pill active" onclick="toggleFilter(this,'all')">All Types</div>
  <div class="pill" onclick="toggleFilter(this,'street')">üõ£Ô∏è Street</div>
  <div class="pill" onclick="toggleFilter(this,'lot')">üÖøÔ∏è Lots</div>
  <div class="pill" onclick="toggleFilter(this,'private')">üîë Private</div>
  <div class="pill" onclick="toggleFilter(this,'free')">üíö Free</div>
</div>

<div class="status-bar" id="statusBar">
  <div class="status-dot" id="statusDot"></div>
  <span id="statusText">Tap the button to find parking near you</span>
</div>

<div class="mini-map" id="miniMap">
  <canvas id="mapCanvas"></canvas>
  <div class="map-overlay">
    <div class="my-loc" id="myLoc" style="position:absolute;left:50%;top:50%"></div>
  </div>
  <div class="legend">
    <div class="legend-item"><div class="legend-dot" style="background:var(--blue)"></div>Street</div>
    <div class="legend-item"><div class="legend-dot" style="background:var(--green)"></div>Lot</div>
    <div class="legend-item"><div class="legend-dot" style="background:var(--yellow)"></div>Private</div>
  </div>
</div>

<div class="results" id="results"></div>

<div class="empty" id="emptyState">
  <div class="empty-icon">üîç</div>
  <h3>No spots found</h3>
  <p>Try adjusting filters or expanding search radius</p>
</div>

<!-- Detail Sheet -->
<div class="sheet-overlay" id="overlay" onclick="closeSheet()"></div>
<div class="sheet" id="sheet">
  <div class="sheet-handle"></div>
  <div id="sheetContent"></div>
</div>

<script>
let activeFilter = 'all';
let allSpots = [];

// Time display
function updateTime() {
  const now = new Date();
  document.getElementById('timeDisplay').textContent =
    now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
}
updateTime();
setInterval(updateTime, 1000);

// Filter logic
function toggleFilter(el, type) {
  document.querySelectorAll('.pill').forEach(p => p.classList.remove('active'));
  el.classList.add('active');
  activeFilter = type;
  renderSpots();
}

// Spot data generator
function generateSpots(lat, lon) {
  const streetNames = ['Oak St', 'Main Ave', 'Elm Blvd', 'Park Rd', 'Cedar Ln', 'River Dr', 'Market St'];
  const lotNames = ['Central Parking Garage', 'Civic Center Lot', 'Riverside P Lot', 'Stadium Parking', 'Downtown Deck'];
  const privateNames = ['Blue Owl Coffee Lot', 'Sunrise Yoga Shared Spot', 'Pete\'s Auto Overflow', 'The Corner Store Rear', 'Maple & Co. Side Lot'];

  const spots = [];
  const now = new Date();

  // Street spots
  for (let i = 0; i < 4; i++) {
    const dist = (0.05 + Math.random() * 0.35).toFixed(2);
    const free = Math.random() > 0.4;
    const avail = Math.floor(Math.random() * 8) + 1;
    spots.push({
      id: 'street_' + i,
      type: 'street',
      name: `${streetNames[i]} (Block ${100 + i * 10})`,
      address: `${streetNames[i]}, near intersection with ${streetNames[(i+2)%7]}`,
      dist: parseFloat(dist),
      price: free ? 0 : (0.5 + Math.random() * 1.5).toFixed(2),
      free,
      avail,
      maxAvail: 10,
      walk: Math.round(dist * 12),
      hours: 'Until 10 PM',
      features: free ? ['Free', '2hr Limit', 'No Permit'] : ['Metered', '2hr Max'],
      mapX: 0.3 + Math.random() * 0.4,
      mapY: 0.2 + Math.random() * 0.6,
    });
  }

  // Green P Lots
  for (let i = 0; i < 3; i++) {
    const dist = (0.1 + Math.random() * 0.6).toFixed(2);
    const avail = Math.floor(Math.random() * 60) + 5;
    spots.push({
      id: 'lot_' + i,
      type: 'lot',
      name: lotNames[i],
      address: `${100 + i * 50} Civic Plaza, Lot ${i+1}`,
      dist: parseFloat(dist),
      price: (1 + Math.random() * 3).toFixed(2),
      free: false,
      avail,
      maxAvail: 80,
      walk: Math.round(dist * 12),
      hours: '24 Hours',
      features: ['Covered', 'Security Cameras', 'EV Charging', 'Accessible'],
      mapX: 0.15 + Math.random() * 0.7,
      mapY: 0.15 + Math.random() * 0.7,
    });
  }

  // Private spots
  for (let i = 0; i < 3; i++) {
    const dist = (0.05 + Math.random() * 0.4).toFixed(2);
    const avail = Math.floor(Math.random() * 5) + 1;
    const free = Math.random() > 0.7;
    spots.push({
      id: 'private_' + i,
      type: 'private',
      name: privateNames[i],
      address: `${200 + i * 30} Local St ‚Äî Partner Spot`,
      dist: parseFloat(dist),
      price: free ? 0 : (0.75 + Math.random() * 2).toFixed(2),
      free,
      avail,
      maxAvail: 5,
      walk: Math.round(dist * 12),
      hours: free ? 'While business open' : '7 AM ‚Äì 9 PM',
      features: ['Partner Verified', free ? 'Free' : 'App Pay', 'Reserve Ahead'],
      mapX: 0.1 + Math.random() * 0.8,
      mapY: 0.1 + Math.random() * 0.8,
    });
  }

  return spots.sort((a, b) => a.dist - b.dist);
}

function availClass(spot) {
  const pct = spot.avail / spot.maxAvail;
  if (pct > 0.5) return 'high';
  if (pct > 0.2) return 'med';
  return 'low';
}
function availLabel(spot) {
  const pct = spot.avail / spot.maxAvail;
  if (pct > 0.5) return `${spot.avail} open`;
  if (pct > 0.2) return `${spot.avail} left`;
  return `${spot.avail} left`;
}
function typeIcon(type) {
  return { street: 'üõ£Ô∏è', lot: 'üÖøÔ∏è', private: 'üîë' }[type];
}
function typeName(type) {
  return { street: 'Street Parking', lot: 'Green P Lot', private: 'Private Spot' }[type];
}

function renderSpots() {
  const container = document.getElementById('results');
  container.innerHTML = '';

  let filtered = allSpots;
  if (activeFilter === 'street') filtered = allSpots.filter(s => s.type === 'street');
  else if (activeFilter === 'lot') filtered = allSpots.filter(s => s.type === 'lot');
  else if (activeFilter === 'private') filtered = allSpots.filter(s => s.type === 'private');
  else if (activeFilter === 'free') filtered = allSpots.filter(s => s.free);

  const empty = document.getElementById('emptyState');
  if (filtered.length === 0) {
    empty.classList.add('show');
    return;
  }
  empty.classList.remove('show');

  const groups = { street: [], lot: [], private: [] };
  filtered.forEach(s => groups[s.type].push(s));

  const order = ['street', 'lot', 'private'];
  let delay = 0;
  order.forEach(type => {
    if (groups[type].length === 0) return;
    const lbl = document.createElement('div');
    lbl.className = 'section-label';
    lbl.textContent = typeName(type) + 's';
    container.appendChild(lbl);

    groups[type].forEach(spot => {
      const card = document.createElement('div');
      card.className = 'spot-card';
      card.style.animationDelay = delay * 60 + 'ms';
      card.innerHTML = `
        <div class="spot-icon-wrap ${spot.type}">${typeIcon(spot.type)}</div>
        <div class="spot-info">
          <div class="spot-name">${spot.name}</div>
          <div class="spot-meta">
            <span class="dist">${spot.dist} mi</span>
            <span>¬∑</span>
            <span class="price">${spot.free ? 'Free' : '$' + spot.price + '/hr'}</span>
            <span>¬∑</span>
            <span>${spot.hours}</span>
          </div>
        </div>
        <div class="spot-right">
          <div class="avail-badge ${availClass(spot)}">${availLabel(spot)}</div>
          <div class="walk-time">~${spot.walk} min walk</div>
        </div>
      `;
      card.onclick = () => openSheet(spot);
      container.appendChild(card);
      delay++;
    });
  });
}

function openSheet(spot) {
  const c = document.getElementById('sheetContent');
  c.innerHTML = `
    <div class="sheet-icon-big">${typeIcon(spot.type)}</div>
    <div class="sheet-name">${spot.name}</div>
    <div class="sheet-addr">${spot.address}</div>
    <div class="sheet-stats">
      <div class="sheet-stat">
        <div class="sheet-stat-val" style="color:var(--blue)">${spot.dist} mi</div>
        <div class="sheet-stat-lbl">Distance</div>
      </div>
      <div class="sheet-stat">
        <div class="sheet-stat-val" style="color:var(--yellow)">${spot.free ? 'Free' : '$' + spot.price}</div>
        <div class="sheet-stat-lbl">${spot.free ? 'No Cost' : 'Per Hour'}</div>
      </div>
      <div class="sheet-stat">
        <div class="sheet-stat-val" style="color:var(--green)">${spot.avail}</div>
        <div class="sheet-stat-lbl">Spots Open</div>
      </div>
    </div>
    <div style="font-size:13px;color:var(--muted);margin-bottom:12px;">‚è∞ ${spot.hours} &nbsp;¬∑&nbsp; üö∂ ~${spot.walk} min walk</div>
    <div class="sheet-features">
      ${spot.features.map(f => `<div class="feature-tag">${f}</div>`).join('')}
    </div>
    <div class="sheet-actions">
      <button class="btn-primary" onclick="navigate('${spot.name}')">üß≠ Navigate</button>
      <button class="btn-secondary" onclick="closeSheet()">‚úï</button>
    </div>
  `;
  document.getElementById('overlay').classList.add('open');
  document.getElementById('sheet').classList.add('open');
}

function closeSheet() {
  document.getElementById('overlay').classList.remove('open');
  document.getElementById('sheet').classList.remove('open');
}

function navigate(name) {
  closeSheet();
  setStatus(`Navigating to ${name}‚Ä¶`, 'green');
}

function setStatus(msg, type) {
  document.getElementById('statusText').textContent = msg;
  const dot = document.getElementById('statusDot');
  dot.className = 'status-dot' + (type ? ' ' + type : '');
}

function drawMap(spots) {
  const canvas = document.getElementById('mapCanvas');
  const map = document.getElementById('miniMap');
  canvas.width = map.offsetWidth;
  canvas.height = map.offsetHeight;
  const ctx = canvas.getContext('2d');

  // Background
  ctx.fillStyle = '#0d1117';
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  // Draw roads
  ctx.strokeStyle = '#21272f';
  ctx.lineWidth = 10;
  // Horizontal roads
  [0.3, 0.6, 0.85].forEach(y => {
    ctx.beginPath();
    ctx.moveTo(0, canvas.height * y);
    ctx.lineTo(canvas.width, canvas.height * y);
    ctx.stroke();
  });
  // Vertical roads
  [0.25, 0.55, 0.8].forEach(x => {
    ctx.beginPath();
    ctx.moveTo(canvas.width * x, 0);
    ctx.lineTo(canvas.width * x, canvas.height);
    ctx.stroke();
  });

  // Draw spot dots
  const colorMap = { street: '#3d9eff', lot: '#00e87a', private: '#f5c518' };
  spots.forEach(s => {
    const x = s.mapX * canvas.width;
    const y = s.mapY * canvas.height;
    ctx.beginPath();
    ctx.arc(x, y, 5, 0, Math.PI * 2);
    ctx.fillStyle = colorMap[s.type];
    ctx.fill();
    ctx.strokeStyle = 'rgba(255,255,255,0.3)';
    ctx.lineWidth = 1.5;
    ctx.stroke();
  });

  // You are here
  const cx = canvas.width * 0.5, cy = canvas.height * 0.5;
  ctx.beginPath();
  ctx.arc(cx, cy, 14, 0, Math.PI * 2);
  ctx.fillStyle = 'rgba(61,158,255,0.2)';
  ctx.fill();
  ctx.beginPath();
  ctx.arc(cx, cy, 6, 0, Math.PI * 2);
  ctx.fillStyle = '#3d9eff';
  ctx.fill();
  ctx.strokeStyle = 'white';
  ctx.lineWidth = 2;
  ctx.stroke();
}

function findParking() {
  const btn = document.getElementById('findBtn');
  const label = document.getElementById('btnLabel');

  btn.classList.add('loading');
  label.textContent = 'Locating‚Ä¶';
  setStatus('Requesting location access‚Ä¶');

  const useLocation = (lat, lon, label) => {
    setStatus(`Scanning ${label}‚Ä¶`, 'green');
    setTimeout(() => {
      allSpots = generateSpots(lat, lon);
      btn.classList.remove('loading');
      document.getElementById('btnLabel').textContent = 'Tap to Refresh';
      setStatus(`Found ${allSpots.length} spots near you ‚Äî updated just now`, 'green');
      document.getElementById('miniMap').classList.add('show');
      renderSpots();
      setTimeout(() => drawMap(allSpots), 50);
    }, 1400);
  };

  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(
      pos => useLocation(pos.coords.latitude, pos.coords.longitude, 'your location'),
      err => {
        // Fallback demo
        useLocation(49.2827, -123.1207, 'demo location (Vancouver)');
      },
      { timeout: 6000 }
    );
  } else {
    useLocation(49.2827, -123.1207, 'demo location');
  }
}
</script>
</body>
</html>
